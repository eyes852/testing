name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions ðŸš€
on: [push]
jobs:
  Build-Container:
    runs-on: ubuntu-20.04
    steps:
      - uses: docker/login-action@v1
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      - run: mkdir -p /tmp/preflight-artifacts
      - run: |-
          docker run \
          -i \
          --rm \
          --security-opt=label=disable \
          --env PFLT_LOGLEVEL=info \
          --env PFLT_ARTIFACTS=/artifacts \
          -v /tmp/preflight-artifacts:/artifacts \
          quay.io/opdev/preflight:stable check container ghcr.io/loxilb-io/kube-loxilb:latest
      - run: cat /tmp/preflight-artifacts/results.json
      - name: get results.json
        id: get_results_json
        uses: notiz-dev/github-action-json-property@v0.2.0
        with:
            path: '/tmp/preflight-artifacts/results.json'
            prop_path: 'image'
      - run: echo ${{ steps.get_results_json.outputs.propStr }}        
      - if: ${{ steps.get_results_json.outputs.prop == true }}
        run: exit 1
